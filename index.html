<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>活動報名</title>

  <meta name="description" content="活動報名｜填完即送出，資料會寫入 Google Sheet" />
  <meta property="og:title" content="活動報名" />
  <meta property="og:description" content="填完即送出，資料會寫入 Google Sheet" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0ea5e9" />

  <script>
    // ✅ 只要改 PIXEL_ID（沒有就留空），其它不用動
    const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxDlJ8o8unlRefrLvJM22lPN7E4Z-TevdkT2Lq1O9ROunLKSVKliq8qylOo_jj-FyyDzQ/exec";
    const THANKS_URL = "/thanks";
    const PIXEL_ID = ""; // 例如 "1059276802371134"；沒有就留空 ""
  </script>

  <!-- Meta Pixel（可選） -->
  <script>
    (function loadPixel(){
      if(!PIXEL_ID) return;
      !function(f,b,e,v,n,t,s){
        if(f.fbq)return; n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n; n.push=n; n.loaded=!0; n.version='2.0';
        n.queue=[]; t=b.createElement(e); t.async=!0;
        t.src=v; s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
      }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', PIXEL_ID);
      fbq('track', 'PageView');
    })();
  </script>

  <style>
    :root{
      --bg:#f6f9fc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --brand:#0ea5e9;
      --brand2:#22c55e;
      --border:#e2e8f0;
      --shadow: 0 10px 30px rgba(2, 8, 23, .08);
      --radius: 18px;
      --max: 980px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial;
      color:var(--text);
      background:
        radial-gradient(900px 400px at 15% -10%, rgba(14,165,233,.14), transparent 60%),
        radial-gradient(900px 420px at 100% 10%, rgba(34,197,94,.10), transparent 55%),
        var(--bg);
      line-height:1.6;
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:22px}

    .topbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(246,249,252,.75);
      border-bottom:1px solid rgba(226,232,240,.85);
    }
    .topbar .wrap{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 22px;
      gap:10px;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-weight:900;
      letter-spacing:.3px;
      font-size:14px;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background:linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 6px 18px rgba(14,165,233,.20);
      flex:0 0 auto;
    }
    nav{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    nav a{
      text-decoration:none;
      font-size:13px;
      color:var(--muted);
      padding:7px 9px;
      border-radius:999px;
    }
    nav a:hover{background:rgba(14,165,233,.10); color:var(--text)}
    @media (max-width: 900px){ nav{display:none} }

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px;
      border:1px solid var(--border);
      background: var(--card);
      padding:10px 12px;
      border-radius:12px;
      text-decoration:none;
      font-weight:800;
      cursor:pointer;
      transition: transform .06s ease, box-shadow .06s ease, background .2s ease, opacity .2s ease;
      font-size:14px;
    }
    .btn:hover{transform: translateY(-1px); box-shadow: 0 12px 24px rgba(2,8,23,.08)}
    .btn.primary{
      border-color: transparent;
      background: linear-gradient(135deg, var(--brand), #38bdf8);
      color: #fff;
    }
    .btn.primary:hover{box-shadow: 0 18px 40px rgba(14,165,233,.22)}
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none; box-shadow:none}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    header.hero{padding:18px 0 8px}
    .heroCard{padding:20px}

    .kicker{
      display:inline-flex;
      gap:10px;
      align-items:center;
      font-size:12px;
      color:var(--muted);
      background: rgba(14,165,233,.08);
      border:1px solid rgba(14,165,233,.16);
      padding:6px 10px;
      border-radius:999px;
      font-weight:800;
    }
    h1{margin:12px 0 8px; font-size: 28px; line-height:1.22; letter-spacing:.2px}
    @media (max-width: 520px){ h1{font-size:24px} }
    .sub{margin:0 0 14px; color:var(--muted); font-size:14px; font-weight:600}

    .heroPhoto{
      width:100%;
      height:280px;
      object-fit:cover;
      border-radius:16px;
      border:1px solid var(--border);
      margin:10px 0 14px;
      background:#fff;
      display:block;
    }
    @media (max-width: 520px){ .heroPhoto{ height:200px; } }

    .pillRow{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin:14px 0 14px;
    }
    @media (max-width: 720px){ .pillRow{grid-template-columns: 1fr} }
    .pill{
      border:1px solid var(--border);
      background: #fff;
      border-radius: 14px;
      padding:10px 12px;
    }
    .pill .t{font-size:12px; color:var(--muted); font-weight:800}
    .pill .v{font-size:15px; font-weight:900; margin-top:2px}

    .notice{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(2,8,23,.18);
      background: rgba(2,8,23,.03);
      color:var(--muted);
      font-size:13px;
      font-weight:650;
    }

    section{padding:14px 0}
    .secTitle{display:flex; align-items:flex-end; justify-content:space-between; gap:10px; margin:8px 0 10px}
    .secTitle h2{margin:0; font-size:18px; letter-spacing:.2px}
    .secTitle .hint{color:var(--muted); font-size:12px; font-weight:650}

    .infoCard{padding:14px}
    .grid{display:grid; gap:12px}
    .twoCol{grid-template-columns: 1fr 1fr; align-items:start}
    @media (max-width: 900px){ .twoCol{grid-template-columns:1fr} }

    .field{
      width:100%;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      font-weight:650;
      outline:none;
      background:#fff;
    }
    .field:focus{border-color: rgba(14,165,233,.6); box-shadow: 0 0 0 3px rgba(14,165,233,.12)}
    .label{display:block; font-size:13px; font-weight:900; margin:10px 0 6px}
    .help{font-size:12px; color:var(--muted); font-weight:650; margin-top:6px}

    .radioRow{display:grid; gap:8px; margin-top:8px}
    .radioItem{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
    }
    .radioItem input{margin-top:2px}

    .checkRow{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border:1px dashed rgba(2,8,23,.18);
      border-radius:12px;
      background: rgba(2,8,23,.03);
      margin-top:12px;
    }

    .ctaRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .muted{color:var(--muted)}
    footer{padding:18px 0 36px; color:var(--muted); font-size:12px}
    .footCard{padding:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <span id="siteName">活動報名</span>
      </div>
      <nav aria-label="導覽">
        <a href="#register">報名</a>
        <a href="#rules">規則</a>
        <a href="#contact">聯絡</a>
      </nav>
      <a class="btn primary" href="#register">立即報名</a>
    </div>
  </div>

  <header class="hero">
    <div class="wrap">
      <div class="card heroCard">
        <div class="kicker" id="kicker">填完即送出｜資料寫入 Google Sheet</div>
        <h1 id="title">活動報名</h1>
        <p class="sub" id="subtitle">請確定能到再報名（額滿即止）。</p>

        <!-- ✅ 圖片固定用 assets/poster.jpg（你換檔就會換圖） -->
        <img class="heroPhoto" src="assets/poster.jpg" alt="活動海報" loading="lazy" />

        <div class="pillRow">
          <div class="pill">
            <div class="t">日期</div>
            <div class="v" id="dateText">2026/03/14（六）</div>
          </div>
          <div class="pill">
            <div class="t">時間</div>
            <div class="v" id="timeText">09:00–12:00</div>
          </div>
          <div class="pill">
            <div class="t">地點</div>
            <div class="v" id="placeText">彰南里活動中心｜大禮堂</div>
          </div>
        </div>

        <div class="notice" id="notice">提醒：作品繳交截止 10:30｜公布並頒獎 11:40</div>
      </div>
    </div>
  </header>

  <main>
    <section id="register">
      <div class="wrap">
        <div class="secTitle">
          <h2>報名</h2>
          <div class="hint">填完即完成送出</div>
        </div>

        <div class="card infoCard">
          <form id="signupForm" class="grid" autocomplete="on">
            <!-- 固定欄位（給 GAS / Sheet） -->
            <input type="hidden" name="活動代碼" id="event_code" />
            <input type="hidden" name="活動名稱" id="event_name" />
            <input type="hidden" name="報名序號" id="reg_id" />
            <input type="hidden" name="備註" id="note_hidden" />

            <label class="label">家長姓名（必填）</label>
            <input class="field" name="家長姓名" required />

            <label class="label">聯絡電話（手機）（必填）</label>
            <input class="field" name="聯絡電話（手機）" required inputmode="tel" />

            <label class="label">孩子姓名（必填）</label>
            <input class="field" name="孩子姓名" required />

            <label class="label">孩子年級／年齡（必填）</label>
            <select class="field" name="孩子年級／年齡" required>
              <option value="">請選擇</option>
              <option>幼兒園</option>
              <option>國小一年級</option>
              <option>國小二年級</option>
            </select>

            <label class="label">參賽組別（必填）</label>
            <div class="radioRow" role="group" aria-label="參賽組別">
              <label class="radioItem">
                <input type="radio" name="參賽組別" value="幼兒組" required />
                <div><b>幼兒組</b><div class="help">家長可適度協助，但不得代畫。</div></div>
              </label>
              <label class="radioItem">
                <input type="radio" name="參賽組別" value="國小低年級組" required />
                <div><b>國小低年級組</b><div class="help">家長請勿動手協助。</div></div>
              </label>
            </div>

            <label class="label">是否能全程參與（9:00–12:00）（必填）</label>
            <select class="field" name="是否能全程參與（9:00–12:00）" required id="full_join">
              <option value="">請選擇</option>
              <option>是，我能全程參與</option>
              <option>否（請勿報名）</option>
            </select>
            <div class="help">若選「否」，系統會阻止送出（避免佔名額）。</div>

            <label class="label">就讀學校（選填）</label>
            <input class="field" name="就讀學校" />

            <label class="label">是否為台南市民（必填）</label>
            <select class="field" name="是否為台南市民" required>
              <option value="">請選擇</option>
              <option>是</option>
              <option>否</option>
            </select>

            <label class="checkRow">
              <input type="checkbox" required />
              <div><b>我同意</b>活動期間之拍照記錄，僅作為活動紀錄與非商業用途。</div>
            </label>

            <div class="ctaRow">
              <button class="btn primary" id="submitBtn" type="submit">送出報名</button>
              <span class="muted" id="submitHint" style="font-weight:800; font-size:13px"></span>
            </div>
          </form>

          <div class="notice" style="margin-top:12px">
            名額有限（額滿即止）。若臨時無法到場，建議盡早取消，讓名額留給需要的家庭。
          </div>
        </div>
      </div>
    </section>

    <section id="rules">
      <div class="wrap">
        <div class="secTitle">
          <h2>規則提醒</h2>
        </div>
        <div class="card infoCard">
          <div class="muted" style="font-weight:800; font-size:13px">
            ・幼兒組：家長可適度協助，但不得代畫<br/>
            ・國小低年級組：家長請勿動手協助<br/>
            ・作品繳交截止：10:30（逾時將影響收件）
          </div>
        </div>
      </div>
    </section>

    <section id="contact">
      <div class="wrap">
        <div class="secTitle">
          <h2>聯絡</h2>
        </div>
        <div class="card infoCard">
          <div class="grid twoCol">
            <div>
              <div style="font-weight:900">主辦單位</div>
              <div class="muted" id="hostText" style="font-weight:800">乾淨校園推廣團隊</div>
              <div style="height:10px"></div>
              <div style="font-weight:900">協辦單位</div>
              <div class="muted" id="cohostText" style="font-weight:800">彰南里活動中心</div>
            </div>
            <div>
              <div style="font-weight:900">洽詢電話</div>
              <div class="muted" id="phoneText" style="font-weight:900; font-size:16px">陳小姐｜0913-837-389</div>
              <div class="help">如臨時無法到場，建議盡早取消，讓名額留給需要的家庭。</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="wrap">
        <div class="card footCard">
          <div>
            <div style="font-weight:900; color:#0b1220" id="footerName">活動報名</div>
            <div class="muted" style="font-weight:700">一頁式報名網站</div>
          </div>
          <div class="muted">© <span id="year"></span></div>
        </div>
      </div>
    </footer>
  </main>

  <script>
    // ====== 活動內容（你未來換活動，只要改這一段就好）======
    const EVENT = {
      siteName: "活動報名",
      title: "乾淨世界「我愛我家」兒童著色畫比賽",
      kicker: "填完即送出｜資料寫入 Google Sheet",
      subtitle: "請確定能到再報名（額滿即止）。",

      dateText: "2026/03/14（六）",
      timeText: "09:00–12:00",
      place: "彰南里活動中心｜大禮堂",

      host: "乾淨校園推廣團隊",
      cohost: "彰南里活動中心",
      phone: "陳小姐｜0913-837-389",

      notice: "提醒：作品繳交截止 10:30｜公布並頒獎 11:40",

      // ✅ 給 Sheet 的活動代碼（方便篩選）
      eventCode: "CW-ILOVEHOME-20260314"
    };

    const $ = (id) => document.getElementById(id);

    $("siteName").textContent = EVENT.siteName;
    $("title").textContent = EVENT.title;
    $("kicker").textContent = EVENT.kicker;
    $("subtitle").textContent = EVENT.subtitle;

    $("dateText").textContent = EVENT.dateText;
    $("timeText").textContent = EVENT.timeText;
    $("placeText").textContent = EVENT.place;

    $("hostText").textContent = EVENT.host;
    $("cohostText").textContent = EVENT.cohost;
    $("phoneText").textContent = EVENT.phone;

    $("notice").textContent = EVENT.notice;

    $("footerName").textContent = EVENT.siteName;
    $("year").textContent = new Date().getFullYear();

    // ====== 送出：防重複 + 報名序號 + UTM/追蹤寫入備註 ======
    function makeRegId() {
      const s = Math.random().toString(16).slice(2, 10).toUpperCase();
      return `TNN-${s}`;
    }

    function getTrackingNote() {
      const p = new URLSearchParams(location.search);
      const keys = ["utm_source","utm_medium","utm_campaign","utm_content","utm_term","fbclid"];
      const parts = [];
      keys.forEach(k => {
        const v = p.get(k);
        if (v) parts.push(`${k}=${v}`);
      });
      const ref = document.referrer || "";
      if (ref) parts.push(`ref=${ref}`);
      if (parts.length === 0) return "";
      return `【追蹤】${parts.join(";")}`;
    }

    (function bindSubmit(){
      const form = $("signupForm");
      if (!form) return;

      // 固定欄位
      $("event_code").value = EVENT.eventCode || "";
      $("event_name").value = EVENT.title || "";

      form.addEventListener("submit", async (ev) => {
        ev.preventDefault();

        // 若選「否（請勿報名）」直接擋下
        const full = $("full_join").value || "";
        if (full.startsWith("否")) {
          alert("這場活動需要能全程參與（9:00–12:00），因此此選項無法完成報名，謝謝你的理解。");
          return;
        }

        if (form.dataset.submitting === "1") return;
        form.dataset.submitting = "1";

        const btn = $("submitBtn");
        const hint = $("submitHint");
        const oldText = btn.textContent;

        btn.disabled = true;
        btn.textContent = "送出中…";
        hint.textContent = "請稍等，正在送出資料";

        try {
          // 報名序號
          if (!$("reg_id").value) $("reg_id").value = makeRegId();
          const rid = $("reg_id").value;

          // 追蹤字串塞進備註（hidden）
          const tracking = getTrackingNote();
          if (tracking) $("note_hidden").value = tracking;

          // 送到 GAS（寫入 Sheet）
          const fd = new FormData(form);
          await fetch(GAS_WEBAPP_URL, { method:"POST", body: fd, mode:"no-cors" });

          // Pixel：完成報名（可選）
          if (window.fbq) fbq("track", "CompleteRegistration");

          // 跳感謝頁
          location.href = `${THANKS_URL}?rid=${encodeURIComponent(rid)}`;
        } catch (e) {
          alert("送出失敗，請稍後再試一次。");
          btn.disabled = false;
          btn.textContent = oldText;
          hint.textContent = "";
          form.dataset.submitting = "0";
        }
      });
    })();
  </script>
</body>
</html>
